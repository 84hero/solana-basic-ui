# Solana 集群概述

Solana 集群是一组验证器一起工作以服务客户端交易并维护账本完整性的集合。许多集群可能共存。当两个集群共享一个共同的创世区块时，它们尝试融合。否则，它们将忽略彼此的存在。发送到错误集群的交易会被悄然拒绝。在本节中，我们将讨论如何创建集群，节点如何加入集群，如何共享账本，如何确保账本复制，以及如何应对有问题和恶意的节点。

## 创建集群

在启动任何验证器之前，首先需要创建一个创世配置。该配置引用了两个公钥，一个是铸币地址，另一个是引导验证器。持有引导验证器私钥的验证器负责将第一个条目添加到账本中。它使用铸币账户初始化其内部状态。该账户将持有由创世配置定义的本地代币数量。然后，第二个验证器联系引导验证器以注册为验证器。其他验证器则通过任何已注册的集群成员注册。

验证器接收来自领导者的所有条目并提交确认这些条目有效的投票。投票后，验证器应存储这些条目。一旦验证器观察到足够数量的副本存在，它就会删除其副本。

## 加入集群

验证器通过发送注册消息到控制平面来进入集群。控制平面使用一种八卦协议实现，这意味着节点可以通过任何现有节点注册，并期望其注册传播到集群中的所有节点。所有节点同步所需的时间与参与集群的节点数量的平方成正比。算法上，这被认为非常慢，但作为交换，节点可以确保最终拥有与其他节点相同的信息，并且该信息不能被任何一个节点审查。

## 发送交易到集群

客户端将交易发送到任何验证器的交易处理单元（TPU）端口。如果节点处于验证器角色，它将交易转发给指定的领导者。如果处于领导者角色，节点将传入的交易打包，时间戳标记它们创建一个条目，并将其推送到集群的数据平面。一旦在数据平面上，交易由验证器节点验证，从而有效地将它们附加到账本中。

## 确认交易

一个 Solana 集群能够在数千个节点上进行亚秒级确认，并计划扩展到数十万个节点。确认时间预计仅随着验证器数量的对数增加，其中对数的底数非常高。例如，如果底数是一千，这意味着对于前一千个节点，确认将是三个网络跳数加上超级多数中最慢的验证器投票所需的时间。对于接下来的百万个节点，确认只增加一个网络跳数。

Solana 将确认定义为从领导者对新条目进行时间戳记到它识别出超级多数账本投票的时间段。

通过以下组合技术可以实现可扩展的确认：

- 1. 使用 VDF 样本对交易进行时间戳记并签署时间戳。
- 2. 将交易分成批次，分别发送给各个节点，并让每个节点与其同伴分享其批次。
- 3. 递归地重复前一步骤，直到所有节点拥有所有批次。
Solana 在固定的间隔时间内轮换领导者，称为槽。每个领导者只能在其分配的槽期间产生条目。因此，领导者对交易进行时间戳记，以便验证器可以查找指定领导者的公钥。然后领导者签署时间戳，以便验证器可以验证签名，从而证明签名者是指定领导者的公钥所有者。

接下来，将交易拆分成批次，以便节点可以将交易发送给多个方，而不必制作多个副本。例如，如果领导者需要将60笔交易发送给6个节点，它会将这60笔交易拆分成10笔交易的批次，并将其中一个批次发送给每个节点。这样领导者可以将60笔交易放在网上，而不是为每个节点制作60笔交易的副本。每个节点然后与其同伴分享其批次。一旦节点收集到所有6个批次，它会重新构建原始的60笔交易集合。

一批交易只能拆分若干次，直到它变得非常小，以至于头信息成为网络带宽的主要消耗者。在撰写本文时（2021年12月），这种方法在大约1,250个验证器上扩展得很好。为了扩展到数十万个验证器，每个节点可以对另一组等大小的节点应用与领导者节点相同的技术。我们称这种技术为 [涡轮块传播](https://docs.solanalabs.com/consensus/turbine-block-propagation)。
